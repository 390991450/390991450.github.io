<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"390991450.github.io","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="入门这个笔记是建立在SSM笔记基础上的, 着重使用以及boot本身的源码解析.如果在此查询不到, 可以查询对应的SSM笔记.">
<meta property="og:type" content="article">
<meta property="og:title" content="springboot">
<meta property="og:url" content="https://390991450.github.io/2021/12/29/%E6%A1%86%E6%9E%B6/springboot/index.html">
<meta property="og:site_name" content="每天一点儿">
<meta property="og:description" content="入门这个笔记是建立在SSM笔记基础上的, 着重使用以及boot本身的源码解析.如果在此查询不到, 可以查询对应的SSM笔记.">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2021-12-29T03:02:26.000Z">
<meta property="article:modified_time" content="2022-01-05T13:44:19.089Z">
<meta property="article:author" content="征途">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://390991450.github.io/2021/12/29/%E6%A1%86%E6%9E%B6/springboot/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>springboot | 每天一点儿</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">每天一点儿</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://390991450.github.io/2021/12/29/%E6%A1%86%E6%9E%B6/springboot/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="征途">
      <meta itemprop="description" content="我的学习笔记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="每天一点儿">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          springboot
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-12-29 11:02:26" itemprop="dateCreated datePublished" datetime="2021-12-29T11:02:26+08:00">2021-12-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-01-05 21:44:19" itemprop="dateModified" datetime="2022-01-05T21:44:19+08:00">2022-01-05</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%A1%86%E6%9E%B6/" itemprop="url" rel="index"><span itemprop="name">框架</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="入门"><a href="#入门" class="headerlink" title="入门"></a>入门</h1><p>这个笔记是建立在SSM笔记基础上的, 着重使用以及boot本身的源码解析.<br>如果在此查询不到, 可以查询对应的SSM笔记.</p>
<span id="more"></span>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p>导入场景依赖</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;parent&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.3.4.RELEASE&lt;/version&gt;</span><br><span class="line">&lt;/parent&gt;</span><br><span class="line"></span><br><span class="line">&lt;dependencies&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">&lt;/dependencies&gt;</span><br></pre></td></tr></table></figure>
<p>创建主程序类,这是因为以前主程序是由tomcat操控的,而现在由我们接手.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@SpringBootApplication</span><br><span class="line">public class MainApplication &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        SpringApplication.run(MainApplication.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>创建控制器</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@RestController</span><br><span class="line">public class HelloController &#123;</span><br><span class="line">    @RequestMapping(&quot;/hello&quot;)</span><br><span class="line">    public String index()&#123;</span><br><span class="line">        return &quot;Hello, SpringBoot 2!&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="简化配置"><a href="#简化配置" class="headerlink" title="简化配置"></a>简化配置</h2><p>统一在application.properties中修改配置<br>在官方文档查询</p>
<h2 id="简化部署"><a href="#简化部署" class="headerlink" title="简化部署"></a>简化部署</h2><p>在maven中使用如下插件,可以直接把项目打包为jar包, 直接在目标服务器执行即可<br>注意:cmd要关闭快速编辑</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;build&gt;</span><br><span class="line">       &lt;plugins&gt;</span><br><span class="line">           &lt;plugin&gt;</span><br><span class="line">               &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">               &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;</span><br><span class="line">           &lt;/plugin&gt;</span><br><span class="line">       &lt;/plugins&gt;</span><br><span class="line">   &lt;/build&gt;</span><br></pre></td></tr></table></figure>
<h1 id="自动配置原理"><a href="#自动配置原理" class="headerlink" title="自动配置原理"></a>自动配置原理</h1><h2 id="依赖管理"><a href="#依赖管理" class="headerlink" title="依赖管理"></a>依赖管理</h2><p>通过在maven中导入父项目的信息从而取得所有可能用上的依赖信息, 这些依赖基本都声明了版本号.<br>所以在使用时只需要导入依赖而不用再关注版本号, 版本号由父项目提供.<br>如果必须要使用特定的版本号, 则在properties标签中声明版本号.<br>场景启动器: spring-boot-starter-web这种格式的依赖是直接配置对应场景下常用的所有依赖.</p>
<h2 id="自动配置"><a href="#自动配置" class="headerlink" title="自动配置"></a>自动配置</h2><p>当前场景需要配置的内容都会由spring帮助配置.<br>默认扫描主程序所在包及其下面所有包,可以在@SpringBootApplication使用scanBasePackages属性设置.</p>
<h2 id="自动配置的过程"><a href="#自动配置的过程" class="headerlink" title="自动配置的过程"></a>自动配置的过程</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@SpringBootApplication以此注解为自动配置的开始. 它是一个复合注解, 又包括:</span><br><span class="line">&#123;</span><br><span class="line">	@SpringBootConfiguration:代表当前类是一个配置类</span><br><span class="line">	@ComponentScan(&quot;&quot;):指定扫描的包</span><br><span class="line">	@EnableAutoConfiguration它又可以分为以下两个注解:</span><br><span class="line">	&#123;</span><br><span class="line">		@AutoConfigurationPackage:导入main文件所在包的所有组件</span><br><span class="line">		@Import(AutoConfigurationImportSelector.class):从配置文件导入写死的127个配置文件</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="按需开启配置"><a href="#按需开启配置" class="headerlink" title="按需开启配置"></a>按需开启配置</h2><p>可以在配置文件中使用debug = true查看哪些配置开启, 哪些配置没有开启.<br>虽然我们127个场景的所有自动配置启动的时候默认全部加载。但是只会按照需求进行部分的配置, 原理就是部分的配置是使用@ConditionalOn…配置的, 没有达到条件就不会配置.</p>
<h2 id="修改默认配置"><a href="#修改默认配置" class="headerlink" title="修改默认配置"></a>修改默认配置</h2><p>通过类型查找, 使用Bean注解返回修改默认配置.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@Bean</span><br><span class="line">@ConditionalOnBean(MultipartResolver.class)  //容器中有这个类型组件</span><br><span class="line">@ConditionalOnMissingBean(name = DispatcherServlet.MULTIPART_RESOLVER_BEAN_NAME) //容器中没有这个名字 multipartResolver 的组件</span><br><span class="line">public MultipartResolver multipartResolver(MultipartResolver resolver) &#123;</span><br><span class="line">    //SpringMVC multipartResolver。防止有些用户配置的文件上传解析器不符合规范</span><br><span class="line">    //给@Bean标注的方法传入了对象参数，这个参数的值就会从容器中找。</span><br><span class="line">    //找到后作为返回值返回时, 又因为有Bean注解, 会自动把返回值的name设为方法名, 并交给容器管理</span><br><span class="line">    //这样就有名称正确的组件了</span><br><span class="line">	return resolver;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="以用户配置优先"><a href="#以用户配置优先" class="headerlink" title="以用户配置优先"></a>以用户配置优先</h2><p>使用@ConditionalOnMissingBean注解, 当用户没配置时才启用对应配置, 用户配置了则不启用.</p>
<h1 id="底层注解"><a href="#底层注解" class="headerlink" title="底层注解"></a>底层注解</h1><h2 id="Configuration"><a href="#Configuration" class="headerlink" title="@Configuration"></a>@Configuration</h2><p>用于完全注解开发, 替换xml文件配置组件(默认单例).</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">//告诉SpringBoot这是一个配置类,proxyBeanMethods是用来指定bean注解的方法是否使用代理, </span><br><span class="line">//默认是true, 所以不论创建几次都是从ioc容器中获得对象, 而使用false, 则每次获取的都是新对象.</span><br><span class="line">//注意, true的时候取得对象相同是因为返回的是一个代理对象, 而即使是false, 这个代理对象仍在, 可以通过getBean获得.</span><br><span class="line">@Configuration(proxyBeanMethods = false) </span><br><span class="line">public class MyConfig &#123;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Full:外部无论对配置类中的这个组件注册方法调用多少次获取的都是之前注册容器中的单实例对象</span><br><span class="line">     * Lite:不再检查容器中是否有对象, 直接创建, 更快</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    @Bean //给容器中添加组件。以方法名作为组件的id。返回类型就是组件类型。返回的值，就是组件在容器中的实例</span><br><span class="line">    public User user01()&#123;</span><br><span class="line">        User zhangsan = new User(&quot;zhangsan&quot;, 18);</span><br><span class="line">        //user组件依赖了Pet组件</span><br><span class="line">        zhangsan.setPet(tomcatPet());</span><br><span class="line">        return zhangsan;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Bean(&quot;tom&quot;)</span><br><span class="line">    public Pet tomcatPet()&#123;</span><br><span class="line">        return new Pet(&quot;tomcat&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>也可以使用注释直接注册组件.</p>
<h2 id="import"><a href="#import" class="headerlink" title="@import"></a>@import</h2><p>注释于组件上方, 导入指定类型的组件, 默认名为全类名.</p>
<h2 id="Conditional"><a href="#Conditional" class="headerlink" title="@Conditional"></a>@Conditional</h2><p>满足指定的条件就进行注入.@ConditionalOn…</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">//当有teacher组件时才注册student组件</span><br><span class="line">@ConditionalOnBean(name = &quot;teacher&quot;)</span><br><span class="line">@Repository</span><br><span class="line">public class student&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="ImportResource"><a href="#ImportResource" class="headerlink" title="ImportResource"></a>ImportResource</h2><p>springboot并不会自动解析bean.xml, 所以要找一个类上方使用这个注解导入.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@ImportResource(&quot;classpath:bean.xml&quot;)</span><br></pre></td></tr></table></figure>
<h2 id="ConfigurationProperties"><a href="#ConfigurationProperties" class="headerlink" title="@ConfigurationProperties"></a>@ConfigurationProperties</h2><p>使用这个注解时在容器中生成对象时, 会在properties中自动搜寻对应要注入的值进行注入.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- properties中 --&gt;</span><br><span class="line">mycar.brand = &quot;BYD&quot;</span><br><span class="line">mycar.price = 1000000</span><br><span class="line">&lt;!-- 对象中使用此功能 --&gt;</span><br><span class="line">@Component</span><br><span class="line">@ConfigurationProperties(prefix = &quot;mycar&quot;)</span><br><span class="line">public class Car &#123;</span><br><span class="line"></span><br><span class="line">    private String brand;</span><br><span class="line">    private Integer price;</span><br><span class="line">&#125;</span><br><span class="line">&lt;!-- 也可以直接在配置文件class中设置自动注入 --&gt;</span><br><span class="line">&lt;!-- 时候处理第三方类时的注入, 因为第三方类并不会设置为组件 --&gt;</span><br><span class="line">@Configuration</span><br><span class="line">@EnableConfigurationProperties(Car.class)</span><br><span class="line">//1、开启Car配置绑定功能</span><br><span class="line">//2、把这个Car这个组件自动注册到容器中</span><br><span class="line">public class MyConfig &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="yml"><a href="#yml" class="headerlink" title="yml"></a>yml</h1><p>一种不只是标记语言的标记语言.</p>
<h2 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h2><p>● key: value  kv之间有空格<br>● 大小写敏感<br>● 使用缩进表示层级关系<br>● 缩进不允许使用tab，只允许空格<br>● 缩进的空格数不重要，只要相同层级的元素左对齐即可<br>● ‘#’表示注释<br>● 字符串无需加引号，如果要加，’’与””表示字符串内容会被 转义/不转义(‘’会直接输出/n)</p>
<h2 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h2><p>字面量：单个的、不可再分的值。date、boolean、string、number、null</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">k: v</span><br></pre></td></tr></table></figure>
<p>对象：键值对的集合。map、hash、set、object </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">行内写法：  k: &#123;k1:v1,k2:v2,k3:v3&#125;</span><br><span class="line">#或</span><br><span class="line">k: </span><br><span class="line">  k1: v1</span><br><span class="line">  k2: v2</span><br><span class="line">  k3: v3</span><br></pre></td></tr></table></figure>
<p>数组：一组按次序排列的值。array、list、queue</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">行内写法：  k: [v1,v2,v3]</span><br><span class="line">#或者</span><br><span class="line">k:</span><br><span class="line"> - v1</span><br><span class="line"> - v2</span><br><span class="line"> - v3</span><br></pre></td></tr></table></figure>
<h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">@Data</span><br><span class="line">public class Person &#123;</span><br><span class="line">    </span><br><span class="line">    private String userName;</span><br><span class="line">    private Boolean boss;</span><br><span class="line">    private Date birth;</span><br><span class="line">    private Integer age;</span><br><span class="line">    private Pet pet;</span><br><span class="line">    private String[] interests;</span><br><span class="line">    private List&lt;String&gt; animal;</span><br><span class="line">    private Map&lt;String, Object&gt; score;</span><br><span class="line">    private Set&lt;Double&gt; salarys;</span><br><span class="line">    private Map&lt;String, List&lt;Pet&gt;&gt; allPets;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Data</span><br><span class="line">public class Pet &#123;</span><br><span class="line">    private String name;</span><br><span class="line">    private Double weight;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yaml表示以上对象</span></span><br><span class="line"><span class="attr">person:</span></span><br><span class="line">  <span class="attr">userName:</span> <span class="string">zhangsan</span></span><br><span class="line">  <span class="attr">boss:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">birth:</span> <span class="number">2019</span><span class="string">/12/12</span> <span class="number">20</span><span class="string">:12:33</span></span><br><span class="line">  <span class="attr">age:</span> <span class="number">18</span></span><br><span class="line">  <span class="attr">pet:</span> </span><br><span class="line">    <span class="attr">name:</span> <span class="string">tomcat</span></span><br><span class="line">    <span class="attr">weight:</span> <span class="number">23.4</span></span><br><span class="line">  <span class="attr">interests:</span> [<span class="string">篮球</span>,<span class="string">游泳</span>]</span><br><span class="line">  <span class="attr">animal:</span> </span><br><span class="line">    <span class="bullet">-</span> <span class="string">jerry</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">mario</span></span><br><span class="line">  <span class="attr">score:</span></span><br><span class="line">    <span class="attr">english:</span> </span><br><span class="line">      <span class="attr">first:</span> <span class="number">30</span></span><br><span class="line">      <span class="attr">second:</span> <span class="number">40</span></span><br><span class="line">      <span class="attr">third:</span> <span class="number">50</span></span><br><span class="line">    <span class="attr">math:</span> [<span class="number">131</span>,<span class="number">140</span>,<span class="number">148</span>]</span><br><span class="line">    <span class="attr">chinese:</span> &#123;<span class="attr">first:</span> <span class="number">128</span>,<span class="attr">second:</span> <span class="number">136</span>&#125;</span><br><span class="line">  <span class="attr">salarys:</span> [<span class="number">3999</span>,<span class="number">4999.98</span>,<span class="number">5999.99</span>]</span><br><span class="line">  <span class="attr">allPets:</span></span><br><span class="line">    <span class="attr">sick:</span></span><br><span class="line">      <span class="bullet">-</span> &#123;<span class="attr">name:</span> <span class="string">tom</span>&#125;</span><br><span class="line">      <span class="bullet">-</span> &#123;<span class="attr">name:</span> <span class="string">jerry</span>,<span class="attr">weight:</span> <span class="number">47</span>&#125;</span><br><span class="line">    <span class="attr">health:</span> [&#123;<span class="attr">name:</span> <span class="string">mario</span>,<span class="attr">weight:</span> <span class="number">47</span>&#125;]</span><br></pre></td></tr></table></figure>
<p>在对应的类上使用@ConfigurationProperties注解,设置prefix = “person”就可以自动注入了.</p>
<h1 id="web开发"><a href="#web开发" class="headerlink" title="web开发"></a>web开发</h1><h2 id="静态资源访问"><a href="#静态资源访问" class="headerlink" title="静态资源访问"></a>静态资源访问</h2><p>只要静态资源放在类路径下： called static/public/resources/META-INF/resources<br>就可以直接访问.<br>在访问时会优先去控制器查询是否有动态资源, 如果有动态资源则进行动态资源的访问, 没有就查询是否有静态资源.<br>为了区别静态资源, 可以选择给静态资源添加前缀(默认无前缀).</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  mvc:</span><br><span class="line">  #默认是/**</span><br><span class="line">    static-path-pattern: /res/**</span><br></pre></td></tr></table></figure>
<p>也可以修改默认的静态资源访问路径</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">spring:  </span><br><span class="line">  resources:</span><br><span class="line">  #加中括号是因为这里传入的是数组</span><br><span class="line">    static-locations: [classpath:/haha/]</span><br></pre></td></tr></table></figure>

<p>欢迎页面<br>静态资源路径下有index.html则访问主页面时可以直接跳转.(这个方式配置了静态资源前缀后会失效!)<br>控制器能处理/index则交给控制器处理.</p>
<h2 id="静态资源访问原理"><a href="#静态资源访问原理" class="headerlink" title="静态资源访问原理"></a>静态资源访问原理</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">        public void addResourceHandlers(ResourceHandlerRegistry registry) &#123;</span><br><span class="line">            //这里进行是否映射静态资源路径的判断(配置文件可以修改addMappings属性)</span><br><span class="line">            //resourceProperties对应的就是spring.web.resources</span><br><span class="line">            if (!this.resourceProperties.isAddMappings()) &#123;</span><br><span class="line">                logger.debug(&quot;Default resource handling disabled&quot;);</span><br><span class="line">                return;</span><br><span class="line">            &#125;</span><br><span class="line">            //从配置文件取得缓存周期,取得缓存控制器(因此也可以通过配置文件修改)</span><br><span class="line">            Duration cachePeriod = this.resourceProperties.getCache().getPeriod();</span><br><span class="line">            CacheControl cacheControl = this.resourceProperties.getCache().getCachecontrol().toHttpCacheControl();</span><br><span class="line">            //webjars的规则</span><br><span class="line">            if (!registry.hasMappingForPattern(&quot;/webjars/**&quot;)) &#123;</span><br><span class="line">                //为webjars路径下的文件配置查找路径, 配置缓存周期和缓存控制器</span><br><span class="line">                customizeResourceHandlerRegistration(registry.addResourceHandler(&quot;/webjars/**&quot;)</span><br><span class="line">                        .addResourceLocations(&quot;classpath:/META-INF/resources/webjars/&quot;)</span><br><span class="line">                        .setCachePeriod(getSeconds(cachePeriod)).setCacheControl(cacheControl));</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            //静态资源路径的规则</span><br><span class="line">            String staticPathPattern = this.mvcProperties.getStaticPathPattern();</span><br><span class="line">            if (!registry.hasMappingForPattern(staticPathPattern)) &#123;</span><br><span class="line">                customizeResourceHandlerRegistration(registry.addResourceHandler(staticPathPattern)</span><br><span class="line">                        //这里的staticlocation就是配置中的默认静态资源访问路径</span><br><span class="line">                        .addResourceLocations(getResourceLocations(this.resourceProperties.getStaticLocations()))</span><br><span class="line">                        .setCachePeriod(getSeconds(cachePeriod)).setCacheControl(cacheControl));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<h2 id="请求参数处理"><a href="#请求参数处理" class="headerlink" title="请求参数处理"></a>请求参数处理</h2><h3 id="rest原理"><a href="#rest原理" class="headerlink" title="rest原理"></a>rest原理</h3><p>boot会帮助我们自动注册hiddenHttpMethodFilter, 它默认接收请求方式的key为_method.<br>它的开启条件是</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">//项目中没有HiddenHttpMethodFilter就使用</span><br><span class="line">@ConditionalOnMissingBean(&#123;HiddenHttpMethodFilter.class&#125;)</span><br><span class="line">//配置文件的spring.mvc.hiddenmethod.filter.enabled是true</span><br><span class="line">@ConditionalOnProperty(</span><br><span class="line">    prefix = &quot;spring.mvc.hiddenmethod.filter&quot;,</span><br><span class="line">    name = &#123;&quot;enabled&quot;&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>实现过程:(能直接发送的请求方式不会走这个过程)<br>先由Filter判断请求方式, 传入的method是否满足要求. 再把这些交给包装模式的wapper, wapper重写了getMethod方法, 让返回值为传入的method.</p>
<h3 id="请求映射原理"><a href="#请求映射原理" class="headerlink" title="请求映射原理"></a>请求映射原理</h3><p>这里对springMVC的DispatcherServlet服务过程进行进一步的源码分析.</p>
<p>handlermapping取得的方法的过程:<br>程序中所有的mapping注解请求地址和它绑定的控制器的地址都会以键值对的形式存储在handlermapping中, 当收到请求地址时会逐个遍历键值对, 为请求地址分配控制器.<br>所以我们也可以自定义handlermapping为不同前缀的键值对分配不同的handlermapping, 形成前缀与handlermapping的映射, 提高查找控制器的速度.</p>
<p>handleradapter为方法进行适配的具体方法:<br>将handlermapping取得的方法交给handleradapter,handleradapter会持有几种适配器, 逐个使用support方法进行判断是否与当前方法进行适配(因此这里也可以自定义), 如果适配则返回这个适配器.<br>使用这个适配器对方法进行解析, 设置参数解析器与返回值处理器. 接着会取得形参的所有详细信息(参数类型,位置,注解等等), 逐个遍历这些形参, 把这些形参交给参数解析器, 参数解析器会遍历它持有的解析方法, 如果参数与解析方法符合, 则利用它的信息进行解析.</p>
<p>解析器解析自定义类的过程:<br>解析器遍历找到解析自定义类的解析器, 进入这个解析器. 创建空的自定义类对象, 逐个遍历传入的参数, 比对属性名, 比对成功后使用converter转换器将这个参数转换为需要的类型, 再把这个数据交给类对象对应的属性. 这里存在一个问题, 当自定义类中属性的类型converter转换器无法转换时, 会出现异常, 所以当自定义类有自定义类属性时, 需要定制自己的converter转换器.</p>
<h3 id="普通参数与基本注解"><a href="#普通参数与基本注解" class="headerlink" title="普通参数与基本注解"></a>普通参数与基本注解</h3><p>(对springMVC笔记的获取请求参数方法进行重写, 建议对照查看)<br>1.注解(为形参注入的注解)<br>@PathVariable:获取请求地址中的参数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//可以取得单个值, 也可以依靠map取得所有的值</span><br><span class="line">@PathVariable(&quot;id&quot;) Integer id,</span><br><span class="line">@PathVariable(&quot;username&quot;) String name,</span><br><span class="line">@PathVariable Map&lt;String,String&gt; pv,</span><br></pre></td></tr></table></figure>
<p>@RequestHeader:获取请求头中的参数<br>@RequestParam:获取请求中的参数<br>@CookieValue:获取cookie的参数<br>以上都可以通过单个或map获取.<br>@RequestBody:获取整个请求体(只有post才有).<br>@RequestAttribute:获取请求域中的参数.</p>
<p>2.使用原生requestAPI取得参数</p>
<p>3.复杂参数(主要作用是用于域对象的设置)<br>map,model 用于设置request域数据.<br>redirectAttributes用于重定向的数据设置.<br>ServletResponse</p>
<p>4.使用预设的自定义对象接收参数</p>
<h2 id="响应值处理"><a href="#响应值处理" class="headerlink" title="响应值处理"></a>响应值处理</h2><p>参数有自己的解析器, 返回值也有自己的解析器. 拿到返回值与类型, 使用类型与返回值解析器进行比对, 比对成功将返回值交给对应的解析器. 解析器通过内容协商确定要响应的类型, 匹配响应的httpmessageconverter进行类型的转换, 同时在响应头告诉浏览器响应的类型.<br>messageconverter有boot再带的一些转换方法, 引入json,xml依赖等也会为其添加转换方法.也可以自己定制相应的转换器.</p>
<h3 id="ResponseBody"><a href="#ResponseBody" class="headerlink" title="@ResponseBody"></a>@ResponseBody</h3><p>响应分为页面跳转与页面响应.<br>将此注释加到控制器上, 返回的String就会作为响应体送回, 不再进行页面跳转.</p>
<h3 id="内容协商"><a href="#内容协商" class="headerlink" title="内容协商"></a>内容协商</h3><p>浏览器在发送请求的时候会附上自己能接收的响应类型, 这个操作称为内容协商.<br>会先取出可以解析杯发送数据的converter, 再逐个判断是否能发送需要的类型, 当满足要求后就使用.</p>
<h2 id="拦截器"><a href="#拦截器" class="headerlink" title="拦截器"></a>拦截器</h2><p>编写拦截器.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">@Component</span><br><span class="line">public class FirstInterceptor implements HandlerInterceptor &#123;</span><br><span class="line">    //这里的返回值决定是否放行</span><br><span class="line">    @Override</span><br><span class="line">    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception &#123;</span><br><span class="line">        System.out.println(&quot;FirstInterceptor--&gt;preHandle&quot;);</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView) throws Exception &#123;</span><br><span class="line">        System.out.println(&quot;FirstInterceptor--&gt;postHandle&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) throws Exception &#123;</span><br><span class="line">        System.out.println(&quot;FirstInterceptor--&gt;afterCompletion&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用springMVC的定制配置拦截器.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">public class webConfig &#123;</span><br><span class="line">    @Bean</span><br><span class="line">    public WebMvcConfigurer webMvcConfigurer()&#123;</span><br><span class="line">        return new WebMvcConfigurer() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void addInterceptors(InterceptorRegistry registry) &#123;</span><br><span class="line">                registry.addInterceptor(new LogInInterceptor())</span><br><span class="line">                        .addPathPatterns(&quot;/**&quot;)//会拦截包括静态资源内的所有资源</span><br><span class="line">                        .excludePathPatterns(&quot;/&quot;,&quot;login&quot;,&quot;/css/**&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="springMVC的定制"><a href="#springMVC的定制" class="headerlink" title="springMVC的定制"></a>springMVC的定制</h2><p>在webConfig中使用方法返回一个新的WebMvcConfigurer, 并在其中重写要定制的方法.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@Bean</span><br><span class="line">public WebMvcConfigurer webMvcConfigurer()&#123;</span><br><span class="line">    return new WebMvcConfigurer() &#123;</span><br><span class="line">        </span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="配置url匹配模式"><a href="#配置url匹配模式" class="headerlink" title="配置url匹配模式"></a>配置url匹配模式</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">public void configurePathMatch(PathMatchConfigurer configurer) &#123;</span><br><span class="line">    //是否将url末尾的/忽略, /user=/user/</span><br><span class="line">    configurer.setUseTrailingSlashMatch(true);</span><br><span class="line">    //创建一个帮助类并交给configurer, 它本身带有一些优化url的方法</span><br><span class="line">    //可以直接使用, 也可以对它进行一些改造</span><br><span class="line">    UrlPathHelper urlPathHelper = new UrlPathHelper();</span><br><span class="line">    //设置自动删除分号,默认true, 设置为false是为了接收矩阵变量</span><br><span class="line">    urlPathHelper.setRemoveSemicolonContent(false);</span><br><span class="line">    configurer.setUrlPathHelper(urlPathHelper);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="添加converter转换器"><a href="#添加converter转换器" class="headerlink" title="添加converter转换器"></a>添加converter转换器</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">public void addFormatters(FormatterRegistry registry) &#123;</span><br><span class="line">    //添加转换器</span><br><span class="line">    //假设传入的字符串是以逗号分隔属性</span><br><span class="line">    registry.addConverter(new Converter&lt;String, Student&gt;() &#123;</span><br><span class="line">        @Override</span><br><span class="line">        public Student convert(String source) &#123;</span><br><span class="line">            if (!source.isEmpty())&#123;</span><br><span class="line">                Student student = new Student();</span><br><span class="line">                String[] split = source.split(&quot;,&quot;);</span><br><span class="line">                student.setName(split[0]);</span><br><span class="line">                student.setAge(Integer.parseInt(split[1]));</span><br><span class="line">                student.setGender(split[2]);</span><br><span class="line">                return student;</span><br><span class="line">            &#125;</span><br><span class="line">            return null;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="扩展messageconverter"><a href="#扩展messageconverter" class="headerlink" title="扩展messageconverter"></a>扩展messageconverter</h3><p>先自定义messageconverter</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">public class MyConverter implements HttpMessageConverter&lt;Student&gt; &#123;</span><br><span class="line">    @Override</span><br><span class="line">    //不允许读</span><br><span class="line">    public boolean canRead(Class clazz, MediaType mediaType) &#123;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public boolean canWrite(Class clazz, MediaType mediaType) &#123;</span><br><span class="line">        //如果要写入的类为student则允许写</span><br><span class="line">        if (clazz==Student.class)&#123;</span><br><span class="line">            return true;</span><br><span class="line">        &#125;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public List&lt;MediaType&gt; getSupportedMediaTypes() &#123;</span><br><span class="line">        //告诉外部可以输出的协议数据类型xml,json,自定义等</span><br><span class="line">        return MediaType.parseMediaTypes(&quot;application/mytype&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    //不写读入方法</span><br><span class="line">    @Override</span><br><span class="line">    public Student read(Class clazz, HttpInputMessage inputMessage) throws IOException, HttpMessageNotReadableException &#123;</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void write(Student student, MediaType contentType, HttpOutputMessage outputMessage) throws IOException, HttpMessageNotWritableException &#123;</span><br><span class="line">        //自定义协议数据的写出, 让属性以句子发送</span><br><span class="line">        String data = student.getName()+&quot;今年&quot;+student.getAge()+&quot;岁,是个&quot;+student.getGender()+&quot;生&quot;;</span><br><span class="line">        //写出</span><br><span class="line">        OutputStream body = outputMessage.getBody();</span><br><span class="line">        body.write(data.getBytes());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在WebMvcConfigurer中调用方法, 添加这个messageconverter</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> @Override</span><br><span class="line">public void extendMessageConverters(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters) &#123;</span><br><span class="line">    converters.add(new MyConverter);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="扩展内容协商功能"><a href="#扩展内容协商功能" class="headerlink" title="扩展内容协商功能"></a>扩展内容协商功能</h3><p>为了使用自定义的messageconverter就需要服务器可以接收到自定义的响应类型请求.<br>传统的写法为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?formant= 响应类型</span><br></pre></td></tr></table></figure>
<p>但服务器默认是不知道自定义的响应类型的, 所以需要扩展内容协商功能<br>这里是重写, 并不是添加.所以如果不添加请求头方式的请求的解析方式的话, 会无法解析请求头发送的请求响应类型.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">public void configureContentNegotiation(ContentNegotiationConfigurer configurer) &#123;</span><br><span class="line">    //设置接收的属性名与响应类型的对应关系</span><br><span class="line">    HashMap&lt;String, MediaType&gt; map = new HashMap&lt;&gt;();</span><br><span class="line">    map.put(&quot;json&quot;,MediaType.APPLICATION_JSON);</span><br><span class="line">    map.put(&quot;xml&quot;,MediaType.APPLICATION_ATOM_XML);</span><br><span class="line">    map.put(&quot;mytype&quot;,MediaType.parseMediaType(&quot;application/mytype&quot;));</span><br><span class="line">    //使用map生成策略</span><br><span class="line">    //生成参数类型请求解析策略</span><br><span class="line">    ParameterContentNegotiationStrategy parameterContentNegotiationStrategy = new ParameterContentNegotiationStrategy(map);</span><br><span class="line">    //生成请求头类型请求解析策略,如果不添加, 就视为默认</span><br><span class="line">    HeaderContentNegotiationStrategy headerContentNegotiationStrategy = new HeaderContentNegotiationStrategy();</span><br><span class="line">    configurer.strategies(Arrays.asList(parameterContentNegotiationStrategy,headerContentNegotiationStrategy));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="配置拦截器"><a href="#配置拦截器" class="headerlink" title="配置拦截器"></a>配置拦截器</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">public void addInterceptors(InterceptorRegistry registry) &#123;</span><br><span class="line">    registry.addInterceptor(new LogInInterceptor())</span><br><span class="line">            .addPathPatterns(&quot;/**&quot;)//会拦截包括静态资源内的所有资源</span><br><span class="line">            .excludePathPatterns(&quot;/&quot;,&quot;login&quot;,&quot;/css/**&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h2><h3 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h3><p>boot不用像SSM一样配置文件上传解析器, 所以可以直接进行设置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">@PostMapping(&quot;/testUp&quot;)</span><br><span class="line">//MultipartFile就存储了上传的各种信息</span><br><span class="line">public String testUp(@RequestPart(&quot;photos&quot;)MultipartFile[] photo, HttpSession session) throws IOException &#123;</span><br><span class="line">    //获取上传的文件的文件名</span><br><span class="line">    String fileName = photo.getOriginalFilename();</span><br><span class="line">    //获取上传的文件的后缀名 </span><br><span class="line">    String suffixName = fileName.substring(fileName.lastIndexOf(&quot;.&quot;));</span><br><span class="line">    //将UUID作为文件名, 应对重名</span><br><span class="line">    String uuid = UUID.randomUUID().toString();</span><br><span class="line">    //将uuid和后缀名拼接后的结果作为最终的文件名</span><br><span class="line">    fileName = uuid + suffixName;</span><br><span class="line">    //通过ServletContext获取服务器中photo目录的路径</span><br><span class="line">    ServletContext servletContext = session.getServletContext();</span><br><span class="line">    String photoPath = servletContext.getRealPath(&quot;photo&quot;);</span><br><span class="line">    File file = new File(photoPath);</span><br><span class="line">    //判断photoPath所对应路径是否存在</span><br><span class="line">    if(!file.exists())&#123;</span><br><span class="line">        //若不存在，则创建目录</span><br><span class="line">        file.mkdir();</span><br><span class="line">    &#125;</span><br><span class="line">    // File.separator是文件分隔符, 这样就构成了指向路径与文件名的一个finalPath </span><br><span class="line">    String finalPath = photoPath + File.separator + fileName;</span><br><span class="line">    //上传文件</span><br><span class="line">    photo.transferTo(new File(finalPath));</span><br><span class="line">    return &quot;success&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="修改配置"><a href="#修改配置" class="headerlink" title="修改配置"></a>修改配置</h3><p>可以在配置文件中修改spring.servlet.multipart的属性来更改配置.</p>
<h3 id="底层过程"><a href="#底层过程" class="headerlink" title="底层过程"></a>底层过程</h3><p>1.自动配置了文件上传解析器<br>2.请求进来使用文件上传解析器判断（isMultipart）并封装（resolveMultipart，返回MultipartHttpServletRequest）文件上传请求<br>3.参数解析器来解析请求中的文件内容封装成MultipartFile<br>4. 将request中文件信息封装为一个Map；MultiValueMap&lt;String, MultipartFile&gt;FileCopyUtils。实现文件流的拷贝</p>
<h2 id="异常处理"><a href="#异常处理" class="headerlink" title="异常处理"></a>异常处理</h2><h3 id="默认规则"><a href="#默认规则" class="headerlink" title="默认规则"></a>默认规则</h3><p>1.默认情况下, 所有错误会交给/error映射.<br>2.对于机器客户端会生成json响应, 其中包含错误, http状态和异常的详细信息. 对于浏览器, 会响应一个包含相同内容的页面.<br>3.要进行自定义, 添加view解析为error<br>4.要完全替换默认行为，可以实现 ErrorController 并注册该类型的Bean定义，或添加ErrorAttributes类型的组件以使用现有机制但替换其内容。<br>5.error目录下的4xx,5xx页面会自动解析</p>
<h3 id="自动配置-1"><a href="#自动配置-1" class="headerlink" title="自动配置"></a>自动配置</h3><p>部分源码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">public class ErrorMvcAutoConfiguration &#123;</span><br><span class="line"></span><br><span class="line">    private final ServerProperties serverProperties;</span><br><span class="line"></span><br><span class="line">    public ErrorMvcAutoConfiguration(ServerProperties serverProperties) &#123;</span><br><span class="line">        this.serverProperties = serverProperties;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    //这里就可以看出, 可以自定义ErrorAttributes实现替换</span><br><span class="line">    @ConditionalOnMissingBean(value = ErrorAttributes.class, search = SearchStrategy.CURRENT)</span><br><span class="line">    public DefaultErrorAttributes errorAttributes() &#123;</span><br><span class="line">        return new DefaultErrorAttributes();</span><br><span class="line">    &#125;</span><br><span class="line">        //DefaultErrorAttributes源码, 用于设置生成错误信息</span><br><span class="line">        public class DefaultErrorAttributes implements ErrorAttributes, HandlerExceptionResolver, Ordered &#123;</span><br><span class="line">            //用于将错误信息以键值对放入域对象    </span><br><span class="line">            @Override</span><br><span class="line">            public ModelAndView resolveException(HttpServletRequest request, HttpServletResponse response, Object handler,Exception ex) &#123;</span><br><span class="line">            storeErrorAttributes(request, ex);</span><br><span class="line">            return null;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        //DefaultErrorAttributes源码结束</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    //这里也是, 可以自定义ErrorController替换</span><br><span class="line">    @ConditionalOnMissingBean(value = ErrorController.class, search = SearchStrategy.CURRENT)</span><br><span class="line">    public BasicErrorController basicErrorController(ErrorAttributes errorAttributes,</span><br><span class="line">            ObjectProvider&lt;ErrorViewResolver&gt; errorViewResolvers) &#123;</span><br><span class="line">        return new BasicErrorController(errorAttributes, this.serverProperties.getError(),</span><br><span class="line">                errorViewResolvers.orderedStream().collect(Collectors.toList()));</span><br><span class="line">    &#125;</span><br><span class="line">        //BasicErrorController源码, 用于设置响应html白页和json</span><br><span class="line">        @Controller</span><br><span class="line">        //如果配置了server.error.path就使用它, 如果没有就取error.path, 还没有就使用/error</span><br><span class="line">        @RequestMapping(&quot;$&#123;server.error.path:$&#123;error.path:/error&#125;&#125;&quot;)</span><br><span class="line">        public class BasicErrorController extends AbstractErrorController &#123;</span><br><span class="line">                //这种不指定value的RequestMapping会在找不到对应的controller时调用</span><br><span class="line">                //用于返回html的请求</span><br><span class="line">                @RequestMapping(produces = MediaType.TEXT_HTML_VALUE)</span><br><span class="line">                public ModelAndView errorHtml(HttpServletRequest request, HttpServletResponse response) &#123;...&#125;</span><br><span class="line">                //用于返回错误json</span><br><span class="line">                @RequestMapping</span><br><span class="line">                public ResponseEntity&lt;Map&lt;String, Object&gt;&gt; error(HttpServletRequest request) &#123;...&#125;</span><br><span class="line">        &#125;</span><br><span class="line">        //BasicErrorController源码结束</span><br><span class="line"></span><br><span class="line">    @Configuration(proxyBeanMethods = false)</span><br><span class="line">    //server.error.whitelabel.enable为true就配置错误视图页面</span><br><span class="line">    @ConditionalOnProperty(prefix = &quot;server.error.whitelabel&quot;, name = &quot;enabled&quot;, matchIfMissing = true)</span><br><span class="line">    @Conditional(ErrorTemplateMissingCondition.class)</span><br><span class="line">    protected static class WhitelabelErrorViewConfiguration &#123;</span><br><span class="line"></span><br><span class="line">        private final StaticView defaultErrorView = new StaticView();</span><br><span class="line"></span><br><span class="line">        //如果没有自定义的error就创建一个错误页面</span><br><span class="line">        @Bean(name = &quot;error&quot;)</span><br><span class="line">        @ConditionalOnMissingBean(name = &quot;error&quot;)</span><br><span class="line">        public View defaultErrorView() &#123;</span><br><span class="line">            return this.defaultErrorView;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // If the user adds @EnableWebMvc then the bean name view resolver from</span><br><span class="line">        // WebMvcAutoConfiguration disappears, so add it back in to avoid disappointment.</span><br><span class="line">        //如果使用@EnableWebMvc全面接管mvc的配置,视图解析器会失效, 所以添加这个方法避免.</span><br><span class="line">        @Bean</span><br><span class="line">        @ConditionalOnMissingBean</span><br><span class="line">        public BeanNameViewResolver beanNameViewResolver() &#123;</span><br><span class="line">            BeanNameViewResolver resolver = new BeanNameViewResolver();</span><br><span class="line">            resolver.setOrder(Ordered.LOWEST_PRECEDENCE - 10);</span><br><span class="line">            return resolver;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="异常处理步骤流程"><a href="#异常处理步骤流程" class="headerlink" title="异常处理步骤流程"></a>异常处理步骤流程</h3><p>1.所有方法出现异常都会被catch然后dispatchException封装<br>2.调用processDispatchResult方法处理异常</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line">private void processDispatchResult(HttpServletRequest request, HttpServletResponse response,</span><br><span class="line">        @Nullable HandlerExecutionChain mappedHandler, @Nullable ModelAndView mv,</span><br><span class="line">        @Nullable Exception exception) throws Exception &#123;</span><br><span class="line"></span><br><span class="line">    boolean errorView = false;</span><br><span class="line"></span><br><span class="line">    //这里进行异常的接收, 并且重新设置mv, 将跳转的错误页面封装到view, 将错误信息封装到model</span><br><span class="line">    if (exception != null) &#123;</span><br><span class="line">        if (exception instanceof ModelAndViewDefiningException) &#123;</span><br><span class="line">            logger.debug(&quot;ModelAndViewDefiningException encountered&quot;, exception);</span><br><span class="line">            mv = ((ModelAndViewDefiningException) exception).getModelAndView();</span><br><span class="line">        &#125;</span><br><span class="line">        else &#123;</span><br><span class="line">            Object handler = (mappedHandler != null ? mappedHandler.getHandler() : null);</span><br><span class="line">            mv = processHandlerException(request, response, handler, exception);</span><br><span class="line">            errorView = (mv != null);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">        //这部分为processHandlerException源码</span><br><span class="line">        @Nullable</span><br><span class="line">        protected ModelAndView processHandlerException(HttpServletRequest request, HttpServletResponse response,@Nullable Object handler, Exception ex) throws Exception &#123;</span><br><span class="line"></span><br><span class="line">            // Success and error responses may use different content types</span><br><span class="line">            request.removeAttribute(HandlerMapping.PRODUCIBLE_MEDIA_TYPES_ATTRIBUTE);</span><br><span class="line"></span><br><span class="line">            // Check registered HandlerExceptionResolvers...</span><br><span class="line">            //遍历HandlerExceptionResolvers进行异常解析</span><br><span class="line">            //这个解析器列表中包含DefaultErrorAttributes以及另外三个解析器.</span><br><span class="line">            //这三个解析器是:1.自己写的处理方法 2. 自己写的异常类 3.mvc自身处理异常类</span><br><span class="line">            ModelAndView exMv = null;</span><br><span class="line">            if (this.handlerExceptionResolvers != null) &#123;</span><br><span class="line">                //逐个调用解析器进行处理, DefaultErrorAttributes会负责将异常信息封装到请求域中</span><br><span class="line">                //其他三个解析器负责解析, 可能可以解析, 也可能解析不了</span><br><span class="line">                for (HandlerExceptionResolver resolver : this.handlerExceptionResolvers) &#123;</span><br><span class="line">                    exMv = resolver.resolveException(request, response, handler, ex);</span><br><span class="line">                    if (exMv != null) &#123;</span><br><span class="line">                        break;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            //如果处理了异常, 就封装返回</span><br><span class="line">            if (exMv != null) &#123;</span><br><span class="line">                if (exMv.isEmpty()) &#123;</span><br><span class="line">                    request.setAttribute(EXCEPTION_ATTRIBUTE, ex);</span><br><span class="line">                    return null;</span><br><span class="line">                &#125;</span><br><span class="line">                // We might still need view name translation for a plain error model...</span><br><span class="line">                if (!exMv.hasView()) &#123;</span><br><span class="line">                    String defaultViewName = getDefaultViewName(request);</span><br><span class="line">                    if (defaultViewName != null) &#123;</span><br><span class="line">                        exMv.setViewName(defaultViewName);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                if (logger.isTraceEnabled()) &#123;</span><br><span class="line">                    logger.trace(&quot;Using resolved error view: &quot; + exMv, ex);</span><br><span class="line">                &#125;</span><br><span class="line">                else if (logger.isDebugEnabled()) &#123;</span><br><span class="line">                    logger.debug(&quot;Using resolved error view: &quot; + exMv);</span><br><span class="line">                &#125;</span><br><span class="line">                WebUtils.exposeErrorRequestAttributes(request, ex, getServletName());</span><br><span class="line">                return exMv;</span><br><span class="line">            &#125;</span><br><span class="line">            //如果没能处理就将异常抛出</span><br><span class="line">            throw ex;</span><br><span class="line">        &#125;</span><br><span class="line">        //processHandlerException源码结束</span><br><span class="line"></span><br><span class="line">    //如果异常被处理mv会不为空, 就执行下面的内容, 否则将异常抛出</span><br><span class="line">    // Did the handler return a view to render?</span><br><span class="line">    if (mv != null &amp;&amp; !mv.wasCleared()) &#123;</span><br><span class="line">        render(mv, request, response);</span><br><span class="line">        if (errorView) &#123;</span><br><span class="line">            WebUtils.clearErrorRequestAttributes(request);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    else &#123;</span><br><span class="line">        if (logger.isTraceEnabled()) &#123;</span><br><span class="line">            logger.trace(&quot;No view rendering, null ModelAndView returned.&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (WebAsyncUtils.getAsyncManager(request).isConcurrentHandlingStarted()) &#123;</span><br><span class="line">        // Concurrent handling started during a forward</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (mappedHandler != null) &#123;</span><br><span class="line">        // Exception (if any) is already handled..</span><br><span class="line">        mappedHandler.triggerAfterCompletion(request, response, null);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>3.如果没能处理异常会请求转发到”/error”<br>4.BasicErrorController处理<br>    {<br>        1.选择返回html还是json<br>        2.(html), 获取到请求域中的错误信息<br>        3.遍历errorViewResolvers选择错误视图解析器(未配置只有一个默认解析器)<br>        4.(默认解析器)使用异常代码.html与”error/“拼接路径, 调用对应的视图页面<br>    }  </p>
<h3 id="定制化"><a href="#定制化" class="headerlink" title="定制化"></a>定制化</h3><p>1.向error文件中添加对应错误的html文件<br>2.@ControllerAdvice(类)+@ExceptionHandler(方法)处理全局异常, 这么配置后HandlerExceptionResolvers的第一个解析器在进行异常处理的时候就可以调用这个方法.<br>3.@ResponseStatus(类)+自定义异常, HandlerExceptionResolvers的第二个解析器在进行异常处理的时候就可以调用这个方法.<br>4.springMVC底层异常, 由HandlerExceptionResolvers的第二三个解析器处理</p>
<h2 id="web原生组件注入-servlet-filter-listener"><a href="#web原生组件注入-servlet-filter-listener" class="headerlink" title="web原生组件注入(servlet,filter,listener)"></a>web原生组件注入(servlet,filter,listener)</h2><h3 id="使用servletAPI"><a href="#使用servletAPI" class="headerlink" title="使用servletAPI"></a>使用servletAPI</h3><p>1.在主方法类上使用@ServletComponentScan(basePackages = “包名”),指定扫描原生servlet组件的位置<br>2.配置servlet, 这种方式配置的servlet会跳过Spring的拦截器, 这是因为Spring的拦截器走的DispatcherServlet.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@WebServlet(urlPatterns = &quot;处理路径&quot;)</span><br><span class="line">public class Myservlet extends HttpServlet &#123;</span><br><span class="line">    @Override</span><br><span class="line">    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException &#123;</span><br><span class="line">        super.doGet(req, resp);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException &#123;</span><br><span class="line">        super.doPost(req, resp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>3.配置过滤器</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">@WebFilter(urlPatterns = &quot;拦截路径&quot;)(单*为servlet写法,双**为spring写法)</span><br><span class="line">public class MyFilter implements Filter &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void init(FilterConfig filterConfig) throws ServletException &#123;</span><br><span class="line">        Filter.super.init(filterConfig);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void destroy() &#123;</span><br><span class="line">        Filter.super.destroy();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>4.配饰监听器</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@WebListener</span><br><span class="line">public class MyListener implements ServletContextListener &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void contextInitialized(ServletContextEvent sce) &#123;</span><br><span class="line">        ServletContextListener.super.contextInitialized(sce);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void contextDestroyed(ServletContextEvent sce) &#123;</span><br><span class="line">        ServletContextListener.super.contextDestroyed(sce);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="使用RegistrationBean"><a href="#使用RegistrationBean" class="headerlink" title="使用RegistrationBean"></a>使用RegistrationBean</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">public class MyRegistConfig &#123;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    public ServletRegistrationBean myServlet()&#123;</span><br><span class="line">        MyServlet myServlet = new MyServlet();</span><br><span class="line"></span><br><span class="line">        return new ServletRegistrationBean(myServlet,&quot;/my&quot;,&quot;/my02&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    public FilterRegistrationBean myFilter()&#123;</span><br><span class="line"></span><br><span class="line">        MyFilter myFilter = new MyFilter();</span><br><span class="line">//        return new FilterRegistrationBean(myFilter,myServlet());</span><br><span class="line">        FilterRegistrationBean filterRegistrationBean = new FilterRegistrationBean(myFilter);</span><br><span class="line">        filterRegistrationBean.setUrlPatterns(Arrays.asList(&quot;/my&quot;,&quot;/css/*&quot;));</span><br><span class="line">        return filterRegistrationBean;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    public ServletListenerRegistrationBean myListener()&#123;</span><br><span class="line">        MySwervletContextListener mySwervletContextListener = new MySwervletContextListener();</span><br><span class="line">        return new ServletListenerRegistrationBean(mySwervletContextListener);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="定制Servlet容器"><a href="#定制Servlet容器" class="headerlink" title="定制Servlet容器"></a>定制Servlet容器</h2><p>1.修改server.下的配置文件(推荐)<br>2.自定义一个ConfigurableServletWebServerFactory<br>3.使用WebServerFactoryCustomizer接口更改配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@Component</span><br><span class="line">public class CustomizationBean implements WebServerFactoryCustomizer&lt;ConfigurableServletWebServerFactory&gt; &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void customize(ConfigurableServletWebServerFactory server) &#123;</span><br><span class="line">        server.setPort(9000);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="定制化-1"><a href="#定制化-1" class="headerlink" title="定制化"></a>定制化</h2><p>正常使用是spring会依据不同的场景使用不同的AutoConfiguration进行配置, 导入不同的组件.<br>1.但是这个组件往往都会使用注解绑定配置文件, 这样我们就可以通过修改配置文件控制组件的导入. 2.除此之外还常会添加@ConditionalOnMissingBean注解, 这个注解也使得我们可以编写自定义的配置类进行替换或增加.<br>3.还可以使用WebMvcConfigurer进行web的定制, 使用WebMvcRegistrations进行最底层的定制.<br>4.使用@EnableWebMvc注解全面接管配置, 完全定制化.</p>
<h1 id="数据访问"><a href="#数据访问" class="headerlink" title="数据访问"></a>数据访问</h1><h2 id="整合druid"><a href="#整合druid" class="headerlink" title="整合druid"></a>整合druid</h2><p>建议参考github文档<br>手动配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">public class MyDataSource &#123;</span><br><span class="line">    //配置数据库连接池    </span><br><span class="line">    //预先在yml写好需要的数据</span><br><span class="line">    @ConfigurationProperties(&quot;spring.datasource&quot;)</span><br><span class="line">    @Bean</span><br><span class="line">    public DataSource dataSource() throws SQLException &#123;</span><br><span class="line">        DruidDataSource dataSource = new DruidDataSource();</span><br><span class="line">        //开启监控统计功能, 开启防火墙,这部分也可以在配置文件中设置</span><br><span class="line">        dataSource.setFilters(&quot;stat,wall&quot;);</span><br><span class="line">        return dataSource;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    //配置servlet</span><br><span class="line">    public ServletRegistrationBean statViewServlet()&#123;</span><br><span class="line">        StatViewServlet statViewServlet = new StatViewServlet();</span><br><span class="line">        ServletRegistrationBean&lt;StatViewServlet&gt; registrationBean = new ServletRegistrationBean&lt;&gt;(statViewServlet,&quot;/druid/*&quot;);</span><br><span class="line">        registrationBean.addInitParameter(&quot;loginUsername&quot;,&quot;lixin&quot;);</span><br><span class="line">        registrationBean.addInitParameter(&quot;loginPassword&quot;,&quot;lixin123&quot;);</span><br><span class="line">        return registrationBean;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    //WebStatFilter用于采集web-jdbc关联监控的数据。</span><br><span class="line">    public FilterRegistrationBean filterRegistrationBean()&#123;</span><br><span class="line">        WebStatFilter webStatFilter = new WebStatFilter();</span><br><span class="line">        FilterRegistrationBean&lt;WebStatFilter&gt; registrationBean = new FilterRegistrationBean&lt;&gt;(webStatFilter);</span><br><span class="line">        registrationBean.setUrlPatterns(Arrays.asList(&quot;/*&quot;));</span><br><span class="line">        registrationBean.addInitParameter(&quot;exclusions&quot;,&quot;*.js,*.gif,*.jpg,*.png,*.css,*.ico,/druid/*&quot;);</span><br><span class="line">        return registrationBean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>快速配置<br>使用starter配置maven<br>使用配置文件spring.datasource.druid前缀进行配置.</p>
<h2 id="整合mybatis"><a href="#整合mybatis" class="headerlink" title="整合mybatis"></a>整合mybatis</h2><p>使用starter配置maven<br>使用配置文件mybatis前缀进行配置</p>
<h1 id="JUnit5"><a href="#JUnit5" class="headerlink" title="JUnit5"></a>JUnit5</h1><table>
<thead>
<tr>
<th>常用注解</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>@Test</td>
<td>表示是测试方法</td>
</tr>
<tr>
<td>@DisplayName</td>
<td>为测试方法或类设置展示名称</td>
</tr>
<tr>
<td>@BeforeEach</td>
<td>每个单元测试前执行</td>
</tr>
<tr>
<td>@AfterEach</td>
<td></td>
</tr>
<tr>
<td>@BeforeAll</td>
<td>需要静态方法</td>
</tr>
<tr>
<td>@AfteAll</td>
<td>需要静态方法</td>
</tr>
<tr>
<td>@Disabled</td>
<td>禁言测试方法</td>
</tr>
<tr>
<td>@Timeout</td>
<td>设置时间限制</td>
</tr>
<tr>
<td>@RepeatedTest</td>
<td>重复测试</td>
</tr>
</tbody></table>
<p>断言失败后面的代码就不会执行,Assertions包</p>
<table>
<thead>
<tr>
<th>断言</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>assertEquals</td>
<td>判断是否相等</td>
</tr>
<tr>
<td>assertNotEquals</td>
<td></td>
</tr>
<tr>
<td>assertSame</td>
<td>是否是同一对象</td>
</tr>
<tr>
<td>assertNotSame</td>
<td></td>
</tr>
<tr>
<td>assertTrue</td>
<td>是否为真</td>
</tr>
<tr>
<td>assertFalse</td>
<td></td>
</tr>
<tr>
<td>assertNull</td>
<td></td>
</tr>
<tr>
<td>assertNotNull</td>
<td></td>
</tr>
<tr>
<td>assertArrayEquals</td>
<td>判断是否数组相等</td>
</tr>
</tbody></table>
<p>参数化测试 使用注解 @ParameterizedTest<br>@ValueSource:为参数化测试指定入参来源, 支持八大类和String以及Class<br>@NullSource: 表示为参数化测试提供一个null的入参<br>@EnumSource: 表示为参数化测试提供一个枚举入参<br>@CsvFileSource：表示读取指定CSV文件内容作为参数化测试入参<br>@MethodSource：表示读取指定方法的返回值作为参数化测试入参(注意方法返回需要是一个流)</p>
<h1 id="指标监控"><a href="#指标监控" class="headerlink" title="指标监控"></a>指标监控</h1><h2 id="引入场景"><a href="#引入场景" class="headerlink" title="引入场景"></a>引入场景</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<p>访问 <a target="_blank" rel="noopener" href="http://localhost:8080/actuator/">http://localhost:8080/actuator/</a>**<br>暴露所有监控信息为HTTP</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">management:</span><br><span class="line">  endpoints:</span><br><span class="line">    enabled-by-default: true #暴露所有端点信息</span><br><span class="line">    web:</span><br><span class="line">      exposure:</span><br><span class="line">        include: &#x27;*&#x27;  #以web方式暴露</span><br></pre></td></tr></table></figure>

<h2 id="常用端点"><a href="#常用端点" class="headerlink" title="常用端点"></a>常用端点</h2><p>最常用的Endpoint<br>● Health：监控状况</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#用于开启详细监控状态</span><br><span class="line">management:</span><br><span class="line">  endpoints:</span><br><span class="line">    health:</span><br><span class="line">        show-details: always</span><br></pre></td></tr></table></figure>
<p>● Metrics：运行时指标<br>提供详细的、层级的、空间指标信息，这些信息可以被pull（主动推送）或者push（被动获取）方式得到；<br>    通过Metrics对接多种监控系统<br>    简化核心Metrics开发<br>    添加自定义Metrics或者扩展已有Metric<br>● Loggers：日志记录</p>
<table>
<thead>
<tr>
<th>ID</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>auditevents</td>
<td>暴露当前应用程序的审核事件信息。需要一个AuditEventRepository组件。</td>
</tr>
<tr>
<td>beans</td>
<td>显示应用程序中所有Spring Bean的完整列表。</td>
</tr>
<tr>
<td>caches</td>
<td>暴露可用的缓存。</td>
</tr>
<tr>
<td>conditions</td>
<td>显示自动配置的所有条件信息，包括匹配或不匹配的原因。</td>
</tr>
<tr>
<td>configprops</td>
<td>显示所有@ConfigurationProperties。</td>
</tr>
<tr>
<td>env</td>
<td>暴露Spring的属性ConfigurableEnvironment</td>
</tr>
<tr>
<td>flyway</td>
<td>显示已应用的所有Flyway数据库迁移。需要一个或多个Flyway组件。</td>
</tr>
<tr>
<td>health</td>
<td>显示应用程序运行状况信息。</td>
</tr>
<tr>
<td>httptrace</td>
<td>显示HTTP跟踪信息（默认情况下，最近100个HTTP请求-响应）。需要一个HttpTraceRepository组件。</td>
</tr>
<tr>
<td>info</td>
<td>显示应用程序信息。</td>
</tr>
<tr>
<td>integrationgraph</td>
<td>显示Spring integrationgraph 。需要依赖spring-integration-core。</td>
</tr>
<tr>
<td>loggers</td>
<td>显示和修改应用程序中日志的配置。</td>
</tr>
<tr>
<td>liquibase</td>
<td>显示已应用的所有Liquibase数据库迁移。需要一个或多个Liquibase组件。</td>
</tr>
<tr>
<td>metrics</td>
<td>显示当前应用程序的“指标”信息。</td>
</tr>
<tr>
<td>mappings</td>
<td>显示所有@RequestMapping路径列表。</td>
</tr>
<tr>
<td>scheduledtasks</td>
<td>显示应用程序中的计划任务。</td>
</tr>
<tr>
<td>sessions</td>
<td>允许从Spring Session支持的会话存储中检索和删除用户会话。需要使用Spring Session的基于Servlet的Web应用程序。</td>
</tr>
<tr>
<td>shutdown</td>
<td>使应用程序正常关闭。默认禁用。</td>
</tr>
<tr>
<td>startup</td>
<td>显示由ApplicationStartup收集的启动步骤数据。需要使用SpringApplication进行配置BufferingApplicationStartup。</td>
</tr>
<tr>
<td>threaddump</td>
<td>执行线程转储。</td>
</tr>
</tbody></table>
<h2 id="定制Endpoint"><a href="#定制Endpoint" class="headerlink" title="定制Endpoint"></a>定制Endpoint</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@Component</span><br><span class="line">public class MyHealthIndicator implements HealthIndicator &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public Health health() &#123;</span><br><span class="line">        int errorCode = check(); // perform some specific health check</span><br><span class="line">        if (errorCode != 0) &#123;</span><br><span class="line">            return Health.down().withDetail(&quot;Error Code&quot;, errorCode).build();</span><br><span class="line">        &#125;</span><br><span class="line">        return Health.up().build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="可视化"><a href="#可视化" class="headerlink" title="可视化"></a>可视化</h2><p>针对微服务进行多服务器的监控, 需要另起端口<br>引入依赖</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;de.codecentric&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-admin-starter-server&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.5.1&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<p>在主程序使用@EnableAdminServer注解开启</p>
<p>在需要被监控的微服务中引入依赖</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;de.codecentric&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-admin-starter-client&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.5.1&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<p>配置汇报端口<br>spring.boot.admin.client.url=<a target="_blank" rel="noopener" href="http://localhost/">http://localhost</a>:</p>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2021/12/28/leetcode%E9%A2%98%E8%A7%A3/%E4%B8%8D%E7%94%A8%E4%B9%98%E9%99%A4%E5%8F%8A%E5%88%A4%E6%96%AD%E5%AE%9E%E7%8E%B0%E7%B4%AF%E5%8A%A0/" rel="prev" title="不用乘除及判断实现累加">
      <i class="fa fa-chevron-left"></i> 不用乘除及判断实现累加
    </a></div>
      <div class="post-nav-item">
    <a href="/2021/12/29/leetcode%E9%A2%98%E8%A7%A3/%E9%87%8D%E5%BB%BA%E4%BA%8C%E5%8F%89%E6%A0%91/" rel="next" title="重建二叉树">
      重建二叉树 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%85%A5%E9%97%A8"><span class="nav-number">1.</span> <span class="nav-text">入门</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8"><span class="nav-number">1.1.</span> <span class="nav-text">使用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AE%80%E5%8C%96%E9%85%8D%E7%BD%AE"><span class="nav-number">1.2.</span> <span class="nav-text">简化配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AE%80%E5%8C%96%E9%83%A8%E7%BD%B2"><span class="nav-number">1.3.</span> <span class="nav-text">简化部署</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86"><span class="nav-number">2.</span> <span class="nav-text">自动配置原理</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BE%9D%E8%B5%96%E7%AE%A1%E7%90%86"><span class="nav-number">2.1.</span> <span class="nav-text">依赖管理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE"><span class="nav-number">2.2.</span> <span class="nav-text">自动配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E7%9A%84%E8%BF%87%E7%A8%8B"><span class="nav-number">2.3.</span> <span class="nav-text">自动配置的过程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8C%89%E9%9C%80%E5%BC%80%E5%90%AF%E9%85%8D%E7%BD%AE"><span class="nav-number">2.4.</span> <span class="nav-text">按需开启配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9%E9%BB%98%E8%AE%A4%E9%85%8D%E7%BD%AE"><span class="nav-number">2.5.</span> <span class="nav-text">修改默认配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%A5%E7%94%A8%E6%88%B7%E9%85%8D%E7%BD%AE%E4%BC%98%E5%85%88"><span class="nav-number">2.6.</span> <span class="nav-text">以用户配置优先</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%BA%95%E5%B1%82%E6%B3%A8%E8%A7%A3"><span class="nav-number">3.</span> <span class="nav-text">底层注解</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Configuration"><span class="nav-number">3.1.</span> <span class="nav-text">@Configuration</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#import"><span class="nav-number">3.2.</span> <span class="nav-text">@import</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Conditional"><span class="nav-number">3.3.</span> <span class="nav-text">@Conditional</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ImportResource"><span class="nav-number">3.4.</span> <span class="nav-text">ImportResource</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ConfigurationProperties"><span class="nav-number">3.5.</span> <span class="nav-text">@ConfigurationProperties</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#yml"><span class="nav-number">4.</span> <span class="nav-text">yml</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AF%AD%E6%B3%95"><span class="nav-number">4.1.</span> <span class="nav-text">语法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="nav-number">4.2.</span> <span class="nav-text">数据类型</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B"><span class="nav-number">4.3.</span> <span class="nav-text">示例</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#web%E5%BC%80%E5%8F%91"><span class="nav-number">5.</span> <span class="nav-text">web开发</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E8%AE%BF%E9%97%AE"><span class="nav-number">5.1.</span> <span class="nav-text">静态资源访问</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E8%AE%BF%E9%97%AE%E5%8E%9F%E7%90%86"><span class="nav-number">5.2.</span> <span class="nav-text">静态资源访问原理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0%E5%A4%84%E7%90%86"><span class="nav-number">5.3.</span> <span class="nav-text">请求参数处理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#rest%E5%8E%9F%E7%90%86"><span class="nav-number">5.3.1.</span> <span class="nav-text">rest原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AF%B7%E6%B1%82%E6%98%A0%E5%B0%84%E5%8E%9F%E7%90%86"><span class="nav-number">5.3.2.</span> <span class="nav-text">请求映射原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%99%AE%E9%80%9A%E5%8F%82%E6%95%B0%E4%B8%8E%E5%9F%BA%E6%9C%AC%E6%B3%A8%E8%A7%A3"><span class="nav-number">5.3.3.</span> <span class="nav-text">普通参数与基本注解</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%93%8D%E5%BA%94%E5%80%BC%E5%A4%84%E7%90%86"><span class="nav-number">5.4.</span> <span class="nav-text">响应值处理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ResponseBody"><span class="nav-number">5.4.1.</span> <span class="nav-text">@ResponseBody</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%86%85%E5%AE%B9%E5%8D%8F%E5%95%86"><span class="nav-number">5.4.2.</span> <span class="nav-text">内容协商</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8B%A6%E6%88%AA%E5%99%A8"><span class="nav-number">5.5.</span> <span class="nav-text">拦截器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#springMVC%E7%9A%84%E5%AE%9A%E5%88%B6"><span class="nav-number">5.6.</span> <span class="nav-text">springMVC的定制</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AEurl%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%BC%8F"><span class="nav-number">5.6.1.</span> <span class="nav-text">配置url匹配模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0converter%E8%BD%AC%E6%8D%A2%E5%99%A8"><span class="nav-number">5.6.2.</span> <span class="nav-text">添加converter转换器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%89%A9%E5%B1%95messageconverter"><span class="nav-number">5.6.3.</span> <span class="nav-text">扩展messageconverter</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%89%A9%E5%B1%95%E5%86%85%E5%AE%B9%E5%8D%8F%E5%95%86%E5%8A%9F%E8%83%BD"><span class="nav-number">5.6.4.</span> <span class="nav-text">扩展内容协商功能</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E6%8B%A6%E6%88%AA%E5%99%A8"><span class="nav-number">5.6.5.</span> <span class="nav-text">配置拦截器</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0"><span class="nav-number">5.7.</span> <span class="nav-text">文件上传</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0"><span class="nav-number">5.7.1.</span> <span class="nav-text">实现</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9%E9%85%8D%E7%BD%AE"><span class="nav-number">5.7.2.</span> <span class="nav-text">修改配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BA%95%E5%B1%82%E8%BF%87%E7%A8%8B"><span class="nav-number">5.7.3.</span> <span class="nav-text">底层过程</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86"><span class="nav-number">5.8.</span> <span class="nav-text">异常处理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%BB%98%E8%AE%A4%E8%A7%84%E5%88%99"><span class="nav-number">5.8.1.</span> <span class="nav-text">默认规则</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE-1"><span class="nav-number">5.8.2.</span> <span class="nav-text">自动配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E6%AD%A5%E9%AA%A4%E6%B5%81%E7%A8%8B"><span class="nav-number">5.8.3.</span> <span class="nav-text">异常处理步骤流程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9A%E5%88%B6%E5%8C%96"><span class="nav-number">5.8.4.</span> <span class="nav-text">定制化</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web%E5%8E%9F%E7%94%9F%E7%BB%84%E4%BB%B6%E6%B3%A8%E5%85%A5-servlet-filter-listener"><span class="nav-number">5.9.</span> <span class="nav-text">web原生组件注入(servlet,filter,listener)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8servletAPI"><span class="nav-number">5.9.1.</span> <span class="nav-text">使用servletAPI</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8RegistrationBean"><span class="nav-number">5.9.2.</span> <span class="nav-text">使用RegistrationBean</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9A%E5%88%B6Servlet%E5%AE%B9%E5%99%A8"><span class="nav-number">5.10.</span> <span class="nav-text">定制Servlet容器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9A%E5%88%B6%E5%8C%96-1"><span class="nav-number">5.11.</span> <span class="nav-text">定制化</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E8%AE%BF%E9%97%AE"><span class="nav-number">6.</span> <span class="nav-text">数据访问</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B4%E5%90%88druid"><span class="nav-number">6.1.</span> <span class="nav-text">整合druid</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B4%E5%90%88mybatis"><span class="nav-number">6.2.</span> <span class="nav-text">整合mybatis</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#JUnit5"><span class="nav-number">7.</span> <span class="nav-text">JUnit5</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%8C%87%E6%A0%87%E7%9B%91%E6%8E%A7"><span class="nav-number">8.</span> <span class="nav-text">指标监控</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BC%95%E5%85%A5%E5%9C%BA%E6%99%AF"><span class="nav-number">8.1.</span> <span class="nav-text">引入场景</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8%E7%AB%AF%E7%82%B9"><span class="nav-number">8.2.</span> <span class="nav-text">常用端点</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9A%E5%88%B6Endpoint"><span class="nav-number">8.3.</span> <span class="nav-text">定制Endpoint</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%AF%E8%A7%86%E5%8C%96"><span class="nav-number">8.4.</span> <span class="nav-text">可视化</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="征途"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">征途</p>
  <div class="site-description" itemprop="description">我的学习笔记</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">83</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">31</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://leetcode-cn.com/limit-v" title="Leetcode → https:&#x2F;&#x2F;leetcode-cn.com&#x2F;limit-v" rel="noopener" target="_blank"><i class="leetcode fa-fw"></i>Leetcode</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://javaguide.cn/home/" title="https:&#x2F;&#x2F;javaguide.cn&#x2F;home&#x2F;" rel="noopener" target="_blank">Javaguide</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://www.xuesql.cn/static/%E9%87%91%E8%80%81%E5%B8%88%E6%89%8B%E5%86%8C.html" title="http:&#x2F;&#x2F;www.xuesql.cn&#x2F;static&#x2F;%E9%87%91%E8%80%81%E5%B8%88%E6%89%8B%E5%86%8C.html" rel="noopener" target="_blank">SQL手册</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://github.phodal.com/" title="http:&#x2F;&#x2F;github.phodal.com" rel="noopener" target="_blank">Github漫游指南</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://www.topgoer.cn/" title="https:&#x2F;&#x2F;www.topgoer.cn" rel="noopener" target="_blank">地鼠文档</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">征途</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
